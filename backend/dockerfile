# ========================

# Stage 1: Build

# ========================

FROM node:20-alpine AS build

# Set working directory
WORKDIR /app



# Copy package files first for caching
COPY package.json package-lock.json ./


# Install dependencies
RUN npm ci --only=production --silent


# Copy source code
COPY . .


# ========================

# Stage 2: Production

# ========================

FROM node:20-alpine AS production

# Set working directory
WORKDIR /app


# Copy only installed dependencies from build stage
COPY --from=build /app/node_modules ./node_modules


# Copy application source code
COPY --from=build /app ./


# Expose port your app listens on
EXPOSE 3000

# Use environment variable for MongoDB connection

# Must be provided at runtime

ENV NODE_ENV=production


# Start the application
CMD ["node", "server.js"]    
